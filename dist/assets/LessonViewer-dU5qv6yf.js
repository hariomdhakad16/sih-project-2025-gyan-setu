import{u as N,j as e}from"./index-B74ufQRA.js";import{r as c,h as k}from"./react-vendor-BnyZ7Ou1.js";import{u as L}from"./utils-vendor-D2OSgIDy.js";import{D as S}from"./db-vendor-FfyO2UEy.js";const C=()=>{const{i18n:s}=L(),{user:o,updateUser:t}=N(),r=c.useMemo(()=>s.language?.split("-")[0]||"en",[s.language]),l=c.useCallback(a=>a?a[r]!==void 0&&a[r]!==null?a[r]:a.en!==void 0&&a.en!==null?a.en:Object.values(a).find(d=>d!=null)||null:null,[r]),i=c.useCallback(async a=>{await s.changeLanguage(a),o&&t({languagePreference:a})},[s,o,t]);return{currentLanguage:r,getLocalized:l,changeLanguage:i,isRTL:r==="pa"}};class D extends S{users;lessons;progress;offline_queue;constructor(){super("GyanSetuDB"),this.version(1).stores({users:"id, &phone",lessons:"id, lastAccessed, subject, grade, downloadStatus",progress:"[userId+lessonId], userId, lessonId",offline_queue:"++id, timestamp"})}}const m=new D,y="gyan-setu-content",h={async clearLessonCache(s){try{const o=await caches.open(y),t=s.media.map(r=>r.url);await Promise.all(t.map(r=>o.delete(r))),await m.lessons.update(s.id,{downloadStatus:"not_downloaded"})}catch(o){throw console.error(`Failed to clear cache for lesson ${s.id}:`,o),o}},async cacheLessonMedia(s,o){const t=await caches.open(y),r=s.media.map(a=>a.url);if(r.length===0){o?.(100);return}let l=0;const i=r.length;for(const a of r){const n=await fetch(a);if(!n.ok)throw new Error(`Failed to fetch ${a}`);await t.put(a,n.clone()),l++,o?.(Math.round(l/i*100))}}},M=500,w=M*1024*1024,_={async runCleanup(s=0){const o=await m.lessons.where("downloadStatus").equals("downloaded").sortBy("lastAccessed");let t=o.reduce((l,i)=>{const a=i.media.reduce((n,d)=>n+(d.size||0),0);return l+a},0),r=0;if(t+s>w)for(const l of o){if(t+s<=w)break;const i=l.media.reduce((a,n)=>a+(n.size||0),0);await h.clearLessonCache(l),t-=i,r+=i}return r},async calculateUsage(){return(await m.lessons.where("downloadStatus").equals("downloaded").toArray()).reduce((o,t)=>o+t.media.reduce((r,l)=>r+(l.size||0),0),0)}},E=s=>{const[o,t]=c.useState(!1),[r,l]=c.useState(0),i=c.useCallback(async()=>{if(!(s.downloadStatus==="downloaded"||o)){t(!0),l(0);try{const n=s.media.reduce((d,u)=>d+(u.size||0),0);await _.runCleanup(n),await m.lessons.update(s.id,{downloadStatus:"pending"}),await h.cacheLessonMedia(s,d=>l(d)),await m.lessons.update(s.id,{downloadStatus:"downloaded",lastAccessed:Date.now()})}catch(n){console.error("Download failed:",n),await m.lessons.update(s.id,{downloadStatus:"not_downloaded"}),l(0)}finally{t(!1)}}},[s,o]),a=c.useCallback(async()=>{try{await h.clearLessonCache(s),l(0)}catch(n){console.error("Remove download failed:",n)}},[s]);return{isDownloading:o,progress:r,downloadLesson:i,removeDownload:a}},A=({lesson:s,onUpdate:o})=>{const{isDownloading:t,progress:r,downloadLesson:l}=E(s),i=async()=>{if(s.downloadStatus==="not_downloaded"){await l();const a=await m.lessons.get(s.id);a&&o(a)}};return e.jsxs("button",{onClick:i,disabled:t||s.downloadStatus==="downloaded",className:"flex items-center justify-between w-full p-4 rounded-lg bg-gray-50 dark:bg-[#162013] border border-gray-200 dark:border-[#2e4328] hover:border-primary dark:hover:border-primary group transition-all disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 relative z-10",children:[e.jsx("div",{className:`bg-gray-200 dark:bg-[#2e4328] p-2 rounded-full text-gray-600 dark:text-white group-hover:bg-primary group-hover:text-white transition-colors ${s.downloadStatus==="downloaded"?"bg-primary text-white":""}`,children:e.jsx("span",{className:"material-symbols-outlined",children:s.downloadStatus==="downloaded"?"check":"download"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-bold text-[#111418] dark:text-white",children:s.downloadStatus==="downloaded"?"Downloaded":"Download for Offline"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Video & Quiz (45MB)"})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-primary transition-all duration-300",style:{width:`${r}%`}}),e.jsxs("span",{className:"text-xs font-bold text-primary relative z-10",children:[r,"%"]})]})]})},q=()=>{const{id:s}=k(),{getLocalized:o}=C(),[t,r]=c.useState(null),[l,i]=c.useState(!0),[a,n]=c.useState(null),[d,u]=c.useState("overview"),b=async()=>{if(s)try{const x=await m.lessons.get(s);x?(r(x),await m.lessons.update(s,{lastAccessed:Date.now()})):n("Lesson not found")}catch(x){console.error("Failed to fetch lesson:",x),n("Failed to load lesson")}finally{i(!1)}};if(c.useEffect(()=>{i(!0),b()},[s]),l)return e.jsxs("div",{className:"flex flex-col items-center justify-center p-20 space-y-4 w-full",children:[e.jsx("span",{className:"loading loading-spinner loading-lg text-primary"}),e.jsx("p",{className:"text-gray-500 dark:text-[#a2c398]",children:"Loading lesson content..."})]});if(a||!t)return e.jsxs("div",{className:"alert alert-error shadow-lg w-full max-w-2xl mx-auto",children:[e.jsx("span",{className:"material-symbols-outlined",children:"error"}),e.jsx("span",{children:a||"Lesson not found"})]});const g=o(t.title)||"Untitled Lesson",p=o(t.content)||"No content available.",f=t.media?.find(x=>x.type==="video"),j=t.thumbnail||"https://lh3.googleusercontent.com/aida-public/AB6AXuCsG4MQddyLTxTIvmHRC6DN2biVR0_d3PF4Z63XqrnQspbNEEqYydS82A-DIMc5d62MnSbIXwmqJNxDhwkahbXOa6ooqAG1rXKEC3pVdEc04GhEVeE3DhZ2pmIopJjH8pmKv9oESPb25kxCnh2lEekzOXj2IghcLnO5e3XMqHVVahcyQ4vTfrvqescuNC4PcY2BE5ZGDoJNkwLhJC8p2bYn32Py7NJaOHXl9bEHpAqcXCiL5v8NWg120K1M8JjJ6ML3n8VTkneUmG8";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-6 min-w-0",children:[e.jsx("div",{className:"relative w-full aspect-video bg-black rounded-lg overflow-hidden group shadow-xl ring-1 ring-white/10",children:f?e.jsxs("video",{controls:!0,className:"w-full h-full object-cover",children:[e.jsx("source",{src:f.url,type:"video/mp4"}),"Your browser does not support the video tag."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-80",style:{backgroundImage:`url('${j}')`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:e.jsx("button",{className:"flex items-center justify-center rounded-full size-16 md:size-20 bg-primary/90 text-white hover:bg-primary hover:scale-105 transition-all shadow-[0_0_30px_rgba(83,210,45,0.4)] backdrop-blur-sm",children:e.jsx("span",{className:"material-symbols-outlined !text-[40px] md:!text-[48px] ml-1",style:{fontVariationSettings:"'FILL' 1"},children:"play_arrow"})})}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/90 via-black/60 to-transparent pt-12 pb-4 px-4 md:px-6 flex flex-col gap-2 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-300",children:[e.jsxs("div",{className:"group/slider relative h-1 hover:h-2 bg-white/30 rounded-full cursor-pointer transition-all",children:[e.jsx("div",{className:"absolute h-full bg-primary rounded-full w-[35%]"}),e.jsx("div",{className:"absolute h-3 w-3 bg-white rounded-full top-1/2 -translate-y-1/2 left-[35%] opacity-0 group-hover/slider:opacity-100 shadow-md"})]}),e.jsxs("div",{className:"flex items-center justify-between text-white mt-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"hover:text-primary transition-colors",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontVariationSettings:"'FILL' 1"},children:"play_arrow"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-mono font-medium tracking-wide",children:[e.jsx("span",{children:"3:45"}),e.jsx("span",{className:"text-white/50",children:"/"}),e.jsx("span",{children:"12:30"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative group/lang",children:e.jsxs("button",{className:"flex items-center gap-1 hover:text-primary transition-colors px-2 py-1 rounded hover:bg-white/10",children:[e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"closed_caption"}),e.jsx("span",{className:"text-xs font-bold uppercase",children:"Pbi"})]})}),e.jsx("button",{className:"hover:text-primary transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"settings"})}),e.jsx("button",{className:"hover:text-primary transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"fullscreen"})})]})]})]}),e.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:e.jsx("span",{className:"px-2 py-1 bg-black/60 backdrop-blur-md rounded text-[10px] font-bold text-white border border-white/10 uppercase tracking-wider",children:"HD 720p"})})]})}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-[#2e4328] gap-6",children:[e.jsx("button",{onClick:()=>u("overview"),className:`pb-3 border-b-2 font-medium text-sm transition-colors ${d==="overview"?"border-primary text-primary font-bold":"border-transparent text-gray-500 dark:text-[#a2c398] hover:text-primary"}`,children:"Overview"}),e.jsx("button",{onClick:()=>u("transcript"),className:`pb-3 border-b-2 font-medium text-sm transition-colors ${d==="transcript"?"border-primary text-primary font-bold":"border-transparent text-gray-500 dark:text-[#a2c398] hover:text-primary"}`,children:"Transcript"}),e.jsx("button",{onClick:()=>u("resources"),className:`pb-3 border-b-2 font-medium text-sm transition-colors ${d==="resources"?"border-primary text-primary font-bold":"border-transparent text-gray-500 dark:text-[#a2c398] hover:text-primary"}`,children:"Resources"})]}),e.jsxs("div",{className:"prose dark:prose-invert max-w-none text-gray-600 dark:text-gray-300",children:[d==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-bold text-[#111418] dark:text-white mb-2",children:g}),typeof p=="string"?e.jsx("div",{dangerouslySetInnerHTML:{__html:p}}):e.jsx("div",{className:"bg-base-200 p-4 rounded-lg font-mono text-sm overflow-auto",children:JSON.stringify(p,null,2)})]}),d==="transcript"&&e.jsx("p",{children:"Transcript not available for this lesson."}),d==="resources"&&e.jsx("div",{className:"flex flex-col gap-2",children:t.media?.map((x,v)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-[#152012] rounded",children:[e.jsx("span",{className:"material-symbols-outlined",children:x.type==="video"?"movie":"image"}),e.jsx("span",{className:"text-sm truncate",children:x.url.split("/").pop()})]},v))||e.jsx("p",{children:"No additional resources."})})]})]}),e.jsxs("div",{className:"w-full lg:w-[360px] flex flex-col gap-6 shrink-0",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1e2c1a] rounded-lg p-6 border border-gray-200 dark:border-[#2e4328] shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-1",children:[e.jsx("span",{className:"px-2 py-1 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-bold",children:t.subject}),e.jsx("span",{className:"px-2 py-1 rounded bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 text-xs font-bold",children:"Medium Difficulty"})]}),e.jsx("h1",{className:"text-2xl font-bold text-[#111418] dark:text-white leading-tight",children:g}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-[#8b9e87] font-medium mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"schedule"}),"15 Mins"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"visibility"}),"1.2k Views"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"translate"}),"3 Languages"]})]})]}),e.jsx("hr",{className:"border-gray-200 dark:border-[#2e4328]"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(A,{lesson:t,onUpdate:b}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{className:"flex flex-col items-center justify-center gap-2 p-3 rounded-lg bg-primary hover:bg-primary/90 text-[#152012] font-bold transition-colors shadow-lg shadow-primary/20",children:[e.jsx("span",{className:"material-symbols-outlined",children:"check_circle"}),e.jsx("span",{className:"text-sm",children:"Mark Complete"})]}),e.jsxs("button",{className:"flex flex-col items-center justify-center gap-2 p-3 rounded-lg bg-white dark:bg-[#253620] border border-gray-200 dark:border-[#3e5634] text-[#111418] dark:text-white font-bold hover:bg-gray-50 dark:hover:bg-[#2e4328] transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"psychology"}),e.jsx("span",{className:"text-sm",children:"Take Quiz"})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1e2c1a] rounded-lg p-6 border border-gray-200 dark:border-[#2e4328] shadow-sm flex flex-col gap-4 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-bold text-[#111418] dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"edit_note"}),"My Notes"]}),e.jsx("button",{className:"text-xs font-bold text-primary hover:text-white transition-colors uppercase tracking-wider",children:"Save"})]}),e.jsx("textarea",{className:"w-full flex-1 min-h-[150px] bg-gray-50 dark:bg-[#152012] border border-gray-200 dark:border-[#2e4328] rounded-lg p-4 text-sm text-[#111418] dark:text-white placeholder-gray-400 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary resize-none transition-all",placeholder:"Type your key takeaways here..."}),e.jsx("p",{className:"text-xs text-gray-400 italic",children:"Notes are saved locally on your device."})]}),e.jsxs("a",{className:"bg-gray-100 dark:bg-[#253620] p-4 rounded-lg border border-transparent hover:border-primary/50 flex items-center justify-between group transition-all",href:"#",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-[#8b9e87] font-bold uppercase",children:"Up Next"}),e.jsx("span",{className:"font-bold text-[#111418] dark:text-white group-hover:text-primary transition-colors",children:"Chapter 5: Cell Structures"})]}),e.jsx("span",{className:"material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors",children:"arrow_forward"})]})]})]})};export{q as LessonViewer};
